 drawer.php | 577 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----
 1 file changed, 533 insertions(+), 44 deletions(-)

diff --git a/drawer.php b/drawer.php
index 0344100..2cb9787 100644
--- a/drawer.php
+++ b/drawer.php
@@ -4,7 +4,7 @@
  * @package   Drawer
  * @author     Joytou, Pzy
  * @copyright  Copyright (c) 2019
- * @version    1.0.0.1(Release)
+ * @version    1.0.1.1(Release)
  *
  * 设置说明
  * $sitetitle - 标题名称
@@ -36,6 +36,7 @@ ini_set( 'open_basedir', $open_basedir ); //限制可访问目录，避免恶意
 define( 'php_self', substr( $_SERVER[ 'PHP_SELF' ], strrpos( $_SERVER[ 'PHP_SELF' ], '/' ) + 1 ) ); //获取文件管理器文件名
 session_start();
 
+$version = '1.0.1.1';
 $dir = ( isset( $_POST[ 'dir' ] ) && $_POST[ 'dir' ] != '' ) ? $_POST[ 'dir' ] : '.'; //获取当前目录
 $dir = htmlspecialchars( $dir );
 $dir = dircode( $dir );
@@ -199,11 +200,30 @@ function maintop() {
 	. '<script src="./js/bootstrap.min.js"></script>'
 	. '<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->'
 	. '<script src="./js/ie10-viewport-bug-workaround.js"></script>'
-	. '<style type="text/css">body{';
-	if ( $showNavbar ): echo 'background-color:#eee';
+	. '<style type="text/css">';
+	echo 'body{';
+	if ( $showNavbar ): echo 'background-color:#eee;padding-right:4px;';
 	else :echo 'background:url("' . $bg . '") 0 0 no-repeat;background-size:cover;';
 	endif;
-	echo '}.form-signin{max-width:330px;padding:15px;margin:0 auto}.form-signin .checkbox,.form-signin .form-signin-heading{margin-bottom:10px}.form-signin .checkbox{font-weight:400}.form-signin .form-control{position:relative;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:10px;font-size:16px}.form-signin .form-control:focus{z-index:2}.form-signin input[type=email]{margin-bottom:-1px;border-bottom-right-radius:0;border-bottom-left-radius:0}.form-signin input[type=password]{margin-bottom:10px;border-top-left-radius:0;border-top-right-radius:0}.blog-footer{padding:40px 0;color:#999;text-align:center;background-color:#f9f9f9;border-top:1px solid #e5e5e5;}.blog-footer p:last-child{margin-bottom:0;}thead>tr>th>a:link,thead>tr>th>a:hover,thead>tr>th>a:active{color:#000;text-decoration:none;}tr.active td{background-color:#ccc!important;}.btn-group.operate{position:fixed;left:35%;bottom:1%;}@media screen and (max-width:425px){.btn-group.operate{left:0%;}}@media screen and (max-width:320px){.btn-group.operate{}#filetable.table>tbody>tr>td, #filetable.table>tbody>tr>th, #filetable.table>tfoot>tr>td, #filetable.table>tfoot>tr>th, #filetable.table>thead>tr>td, #filetable.table>thead>tr>th{padding-left:0;padding-right:0;}}div.page-header.text-center span{display:inline-block;height:39px;width:45px;background:url("' . $logo . '");background-repeat:no-repeat;background-size:contain;}div.page-header.text-center h1{display:inline;}table#filetable td:nth-child(1){word-break:break-all;width:0;}</style>'
+	echo '}'
+	.'.form-signin{max-width:330px;padding:15px;margin:0 auto}'
+	.'.form-signin .checkbox,.form-signin .form-signin-heading{margin-bottom:10px}'
+	.'.form-signin .checkbox{font-weight:400}'
+	.'.form-signin .form-control{position:relative;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:10px;font-size:16px}'
+	.'.form-signin .form-control:focus{z-index:2}'
+	.'.form-signin input[type=email]{margin-bottom:-1px;border-bottom-right-radius:0;border-bottom-left-radius:0}'
+	.'.form-signin input[type=password]{margin-bottom:10px;border-top-left-radius:0;border-top-right-radius:0}'
+	.'.blog-footer{padding:40px 0;color:#999;text-align:center;background-color:#f9f9f9;border-top:1px solid #e5e5e5;}'
+	.'.blog-footer p:last-child{margin-bottom:0;}'
+	.'thead>tr>th>a:link,thead>tr>th>a:hover,thead>tr>th>a:active{color:#000;text-decoration:none;}'
+	.'tr.active td{background-color:#ccc!important;}'
+	.'.btn-group.operate{position:fixed;left:35%;bottom:1%;}'
+	.'@media screen and (max-width:425px){.btn-group.operate{left:0%;}}'
+	.'@media screen and (max-width:320px){.btn-group.operate{}#filetable.table>tbody>tr>td, #filetable.table>tbody>tr>th, #filetable.table>tfoot>tr>td, #filetable.table>tfoot>tr>th, #filetable.table>thead>tr>td, #filetable.table>thead>tr>th{padding-left:0;padding-right:0;}}'
+	.'div.page-header.text-center span{display:inline-block;height:39px;width:45px;background:url("' . $logo . '");background-repeat:no-repeat;background-size:contain;}'
+	.'div.page-header.text-center h1{display:inline;}'
+	.'table#filetable td:nth-child(1){word-break:break-all;width:0;}'
+	.'</style>'
 	. '</head>'
 	. '<body>';
 	if ( $showNavbar == true ) {
@@ -218,6 +238,7 @@ function maintop() {
 		. '<li><a href="javascript:void(0);" onClick="fcreate()"><i class="fa fa-file"></i>新建文件</a></li>'
 		. '<li><a href="javascript:void(0);" onClick="fupload()"><i class="fa fa-upload"></i>上传文件</a></li>'
 		. '<li><a href="javascript:void(0);" onClick="fremotedownload()"><i class="fa fa-cloud-download"></i>远程下载</a></li>'
+		. '<li><a href="javascript:void(0);" onClick="checkVersion()"><i class="fa fa-info-circle"></i>检查更新</a></li>'
 		. '<li><a href="javascript:void(0);" onClick="logout()"><i class="fa fa-sign-out"></i>注销</a></li>'
 		. '</ul>'
 		. '</div>'
@@ -237,7 +258,7 @@ function maintop() {
  */
 function mainbottom() {
 	echo '</div>'
-		. '<div id="paddingDiv"></div>'
+	. '<div id="paddingDiv"></div>'
 	. '<footer class="blog-footer">'
 	. '<p>&copy; 2019 Joytou</p>'
 	. '<p>Designed by Pzy</p>'
@@ -379,9 +400,12 @@ function fcopy( $file, $tofile, $targetfile ) {
 				}
 			}
 		} else {
-			if ( copy( $file, $tofile . $targetfile ) ) {
+			if(($handle1=fopen($file, 'r'))&&($handle2=fopen($tofile.$targetfile, 'w'))){
+				stream_copy_to_stream($handle1, $handle2);
+				fclose($handle1);
+				fclose($handle2);
 				$result .= "{$file}已复制到{$tofile}{$targetfile}<br>";
-			} else {
+			}else{
 				$result .= "{$file}无法复制到{$tofile}{$targetfile}<br>";
 			}
 		}
@@ -417,9 +441,13 @@ function fcut( $file, $tofile, $targetfile ) { //和function fcopy( $file, $tofi
 				}
 			}
 		} else {
-			if ( copy( $file, $tofile . $targetfile ) && unlink( $file ) ) {
+			if(($handle1=fopen($file, 'r'))&&($handle2=fopen($tofile.$targetfile, 'w'))){
+				stream_copy_to_stream($handle1, $handle2);
+				fclose($handle1);
+				fclose($handle2);
+				unlink($file);
 				$result .= "{$file}已移动到{$tofile}{$targetfile}<br>";
-			} else {
+			}else{
 				$result .= "{$file}无法移动到{$tofile}{$targetfile}<br>";
 			}
 		}
@@ -567,9 +595,31 @@ function fcreate( $path, $file, $type ) {
  * @return string
  */
 function fupload( $path ) {
-	$result = "";
+	$result = '';
 	if ( $_FILES[ "data" ][ "error" ] > 0 ) {
-		$result .= "文件上传出错：" . $_FILES[ "data" ][ "error" ];
+		$result .= '文件上传出错：<br/>';
+		$result .= '错误代码：0x00000' . $_FILES[ 'data' ][ 'error' ].'<br/>';
+		$result .= '错误原因：';
+		switch($_FILES[ 'data' ][ 'error' ]){
+			case 1:
+				$result.='上传的文件数量超过了服务器限制：'.ini_get('max_file_uploads');
+				break;
+			case 2:
+				$result.='上传的文件大小超过了服务器限制：'.ini_get('upload_max_filesize');
+				break;
+			case 3:
+				$result.='文件上传不完整';
+				break;
+			case 4:
+				$result.='没有文件被上传';
+				break;
+			case 6:
+				$result.='找不到服务器临时文件夹'.ini_get('upload_tmp_dir').'，请确保服务器配置无误';
+				break;
+			case 7:
+				$result.='文件写入失败，请确保当前文件夹以及文件具有写入权限';
+				break;
+		}
 	} else {
 		if ( file_exists( $path . '/' . $_FILES[ "data" ][ "name" ] ) ) {
 			$result .= $_FILES[ "data" ][ "name" ] . "文件已经存在。 ";
@@ -591,19 +641,42 @@ function fupload( $path ) {
  * @return array
  */
 function traverseDir( $dira ) {
-	$arr = array();
 	if ( $dh = opendir( $dira ) ) {
 		while ( ( $file = readdir( $dh ) ) !== false ) {
 			if ( ( $file != '.' ) && ( $file != '..' ) && is_dir( $dira . '/' . $file ) ) {
-				$arr[] = $dira . '/' . $file;
+				yield $dira . '/' . $file;
 				foreach ( traverseDir( $dira . '/' . $file ) as $v ) {
-					$arr[] = encode($v)['string'];
+					yield encode($v)['string'];
 				}
 			}
 			clearstatcache();
 		}
 	}
-	return $arr;
+}
+
+/**
+ * 遍历出所有文件或文件夹(实验功能)
+ */
+function outputDir( $dira, $hide=false ) {
+	$tmp='';
+	if ( $dh = opendir( $dira ) ) {
+		$tmp.='<ul class'.($hide?' style="display:none"':'').'>';
+		while ( ( $file = readdir( $dh ) ) !== false ) {
+			if ( ( $file != '.' ) && ( $file != '..' ) && is_dir( $dira . '/' . $file ) ) {
+				$fileId=sizeof(explode('/', ( $dira . '/' . $file )))-1;
+				$tmp.='<li>';
+				$tmp.='<div class="treeNode" style="padding-left: '.(20*$fileId).'px" data-file-id="'.$fileId.'" data-file="'.$dira . '/' . $file.'">';
+						$tmp.='<i class="fa fa-plus-square"></i>';
+						$tmp.='<i class="fa fa-folder"></i>';
+						$tmp.='<span class="title">'.encode($file)['string'].'</span>';
+					$tmp.='</div>';
+					$tmp.=outputDir( $dira . '/' . $file, true );
+				$tmp.='</li>';
+			}
+		}
+		$tmp.='</ul>';
+	}
+	return $tmp;
 }
 
 /**
@@ -795,7 +868,17 @@ function downloadProgress_callback( $ch, $countDownloadSize, $currentDownloadSiz
 	$progress .= ($currentDownloadSize/$countDownloadSize*100).'%';
 	$msg = $progress;
 }
+
 if ( !function_exists( 'array_column' ) ) {
+	/**
+	 * 返回输入数组中某个单一列的值。
+	 *
+	 * @access public
+	 * @param array $input 规定要使用的多维数组（记录集）
+	 * @param string $columnKey 需要返回值的列
+	 * @param string $indexKey 用作返回数组的索引/键的列
+	 * @return array
+	 */
 	function array_column( array $input, $columnKey, $indexKey = null ) {
 		$array = array();
 		foreach ( $input as $value ) {
@@ -826,10 +909,7 @@ if ( !function_exists( 'array_column' ) ) {
  *
  * @access public
  * @param $ch
- * @param int $countDownloadSize 下载的文件总大小
- * @param int $currentDownloadSize 已下载的文件大小
- * @param int $countUploadSize 上传的文件总大小
- * @param int $currentUploadSize 已上传的文件大小
+ * @param string $dir 要遍历的文件夹
  */
 function showFileList( $dir ) {
 	global $username, $password;
@@ -1113,6 +1193,7 @@ $dirarray[$i]=encode($dirarray[$i])['string'];
 		<button type="button" class="btn btn-primary" onClick="fcopy()">复制</button>
 		<button type="button" class="btn btn-primary" onClick="fcut()">移动</button>
 		<button type="button" class="btn btn-primary" onClick="fchmod()">权限</button>
+		<button type="button" class="btn btn-primary" onClick="fcompare()">对比</button>
 	</div>
 	<div id="loadModal"></div>
 	<?php
@@ -1143,7 +1224,7 @@ function loadModal(){
  *加载自定义javascript
  */
 function loadScript( $init = false ) {
-	global $username, $password,$dir;
+	global $username, $password, $dir,$opendfile, $operate, $extradata, $version;
 	?>
 	<script type="text/javascript">
 		history.replaceState(null, null, document.URL);
@@ -1187,7 +1268,7 @@ function loadScript( $init = false ) {
 		function opendir( data ) {
 			$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "showfilelist",
 					dir: data
 				},
@@ -1277,7 +1358,7 @@ function loadScript( $init = false ) {
 				$( '#myModal .modal-footer .btn' ).click(function(){
 					$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "batchrename",
 						dir: dir,
 						file:arrElement.toString(),
@@ -1312,7 +1393,7 @@ function loadScript( $init = false ) {
 			var newname=element.val();
 			$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "rename",
 					dir: dirname,
 					file:oldname,
@@ -1331,7 +1412,7 @@ function loadScript( $init = false ) {
 				var type=$( '#sel2' ).val();
 				$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "create",
 						dir: "<?php echo $dir ?>",
 						file:filename,
@@ -1347,14 +1428,14 @@ function loadScript( $init = false ) {
 		}
 		function fupload() {
 			$( "#loadModal" ).html('<?php loadModal(); ?>');
-			$( '#myModal .modal-body' ).html( "<form id=\"fileform\" action=\"<?php echo php_self ?>\" method=\"post\"  enctype=\"multipart/form-data\"><div class=\"custom-file\"><input type=\"file\" class=\"custom-file-input\" name=\"data\" id=\"customFile\"><input type=\"hidden\" name=\"username\" value=\"<?php echo $username;?>\"><input type=\"hidden\" name=\"password\" value=\"<?php echo $password;?>\"><input type=\"hidden\" name=\"op\" value=\"upload\"><input type=\"hidden\" name=\"dir\" value=\"<?php echo $dir ?>\"><label class=\"custom-file-label\" for=\"customFile\">选择文件</label></div></form>" );
+			$( '#myModal .modal-body' ).html( "<form id=\"fileform\" action=\"<?php echo php_self ?>\" method=\"post\"  enctype=\"multipart/form-data\"><div class=\"custom-file\"><input type=\"file\" class=\"custom-file-input\" name=\"data\" id=\"customFile\"><input type=\"hidden\" name=\"username\" value=\"<?php echo $username;?>\"><input type=\"hidden\" name=\"password\" value=\"<?php echo md5($password);?>\"><input type=\"hidden\" name=\"op\" value=\"upload\"><input type=\"hidden\" name=\"dir\" value=\"<?php echo $dir ?>\"><label class=\"custom-file-label\" for=\"customFile\">选择文件</label></div></form>" );
 			var formData = new FormData();
 			$( '#myModal .modal-title' ).text( "上传文件" );
 			$( '#myModal .modal-footer .btn' ).text( "上传" );	
 			$( '#myModal .modal-footer .btn' ).attr("onclick","");
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				formData.append("username", "<?php echo $username;?>");
-				formData.append("password", "<?php echo $password;?>");
+				formData.append("password", "<?php echo md5($password);?>");
 				formData.append("op", "upload");
 				formData.append("dir", "<?php echo $dir ?>");
 				formData.append("data",$('#customFile')[0].files[0]);
@@ -1395,6 +1476,55 @@ function loadScript( $init = false ) {
 				backdrop: false
 			} )
 		}
+		function checkVersion(){
+			var url=eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('"4://1.3.2/8/5/0/7/6"',62,9,'Drawer|api|com|github|https|joytou|latest|releases|repos'.split('|'),0,{}));
+			$( "#loadModal" ).html('<?php loadModal(); ?>');
+			$( '#myModal .modal-body' ).html("<i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>正在检查更新，请稍候...");
+			$( '#myModal .modal-title' ).text( "检查更新" ); 
+			$( '#myModal .modal-footer .btn' ).text( "确定" ); 
+			$( '#myModal .modal-footer .btn' ).attr("onclick","");
+			setTimeout(function(){
+				$.getJSON(url,function(data,status,xhr){
+					var pattern = /([\d]+).([\d]+).([\d]+).([\d])/;
+					var latestVirsion = pattern.exec(data['name']);
+					var localVirsion = pattern.exec("<?php echo $version; ?>");
+					if(parseInt(latestVirsion[1])>parseInt(localVirsion[1]) || 
+						parseInt(latestVirsion[2])>parseInt(localVirsion[2]) || 
+						parseInt(latestVirsion[3])>parseInt(localVirsion[3]) || 
+						parseInt(latestVirsion[4])>parseInt(localVirsion[4])){
+						var filesize = parseInt(data['assets'][0]['size']);
+						if ( filesize < 1024 ) {
+							filesize = filesize+ 'B';
+						} else if ( filesize >= 1024 && filesize < 1048576 ) {
+							filesize = ( filesize / 1024 ).toFixed(2) + 'K';
+						} else if ( filesize >= 1048576 && filesize < 1073741824 ) {
+							filesize = ( filesize / 1048576 ).toFixed(2) + 'M';
+						} else {
+							filesize = ( filesize / 1073741824 ).toFixed(2) + 'G';
+						}
+						$( '#myModal .modal-body' ).html('检测到新版本：<strong>'+data['name']+'</strong>'
+						+'<br/>文件大小：'+filesize
+						+'<br/>发布时间：'+(data['published_at'].replace(/[T|Z]/g,'&nbsp;&nbsp;'))
+						+'<br/>更新内容：<br/>&nbsp;&nbsp;&nbsp;&nbsp;'+(data['body'].replace(/\r\n/g,"<br/>&nbsp;&nbsp;&nbsp;&nbsp;"))
+						+'<br/>是否更新？');
+						$( '#myModal .modal-footer .btn' ).text( "下载" );
+						$( '#myModal .modal-footer .btn' ).click(function(){
+							var link = document.createElement('a');
+							link.style.display = 'none';
+							link.href = data['assets'][0]['browser_download_url'];
+							document.body.appendChild(link);
+							link.click();
+							document.body.removeChild(link);
+						});
+					}else{
+						$( '#myModal .modal-body' ).html("当前已经是最新版本<br/>版本号："+data['name']);
+					}
+				});
+			},1000);
+			$( '#myModal' ).modal( {
+				backdrop: false
+			} )
+		}
 		function fremotedownload(){
 			$( "#loadModal" ).html('<?php loadModal(); ?>');
 			$( '#myModal .modal-body' ).html("什么是远程下载？<br>远程下载是从其它服务器获取文件并直接下载到当前服务器的一种功能。<br>类似于SSH的Wget功能，免去我们下载再手动上传所浪费的时间。<select class='form-control' id='sel1'><option>.</option><?php foreach(traverseDir(".") as $v){echo "<option".($v==$dir?" selected='selected'":"").">{$v}</option>"; } ?></select><input type='text' class='form-control' id='usre' value=\"\" placeholder='请输入远程文件的下载地址'>");
@@ -1406,7 +1536,7 @@ function loadScript( $init = false ) {
 				var filename=$('input[type=text]#usre').val();
 				var formData = new FormData();
 				formData.append("username", "<?php echo $username;?>");
-				formData.append("password", "<?php echo $password;?>");
+				formData.append("password", "<?php echo md5($password);?>");
 				formData.append("op", "remotedownload");
 				formData.append("dir", $('#sel1').val());
 				formData.append("file",$('input[type=text]#usre').val());
@@ -1464,7 +1594,7 @@ function loadScript( $init = false ) {
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "zip",
 					dir: "<?php echo $dir ?>",
 					file:arr
@@ -1491,7 +1621,7 @@ function loadScript( $init = false ) {
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "del",
 					dir: "<?php echo $dir ?>",
 					file:arr
@@ -1518,7 +1648,7 @@ function loadScript( $init = false ) {
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "copy",
 					dir: "<?php echo $dir ?>",
 					file:arr,
@@ -1546,7 +1676,7 @@ function loadScript( $init = false ) {
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "cut",
 					dir: "<?php echo $dir ?>",
 					file:arr,
@@ -1615,7 +1745,7 @@ function loadScript( $init = false ) {
 			$( '#myModal .modal-footer .btn' ).click(function(){
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "chmod",
 					dir: "<?php echo $dir ?>",
 					file:arr,
@@ -1629,6 +1759,43 @@ function loadScript( $init = false ) {
 				backdrop: false
 			} )
 		}
+		function fcompare(){
+			$( "#loadModal" ).html('<?php loadModal(); ?>');
+			$( '#myModal .modal-body' ).html('<div id="edit_div_title" style="border-bottom: 1px solid #e5e5e5;"></div><div id="edit_div" style="overflow-y: scroll;"><div id="edit_div1" style="float:left;width:45%;overflow-wrap: break-word;"></div><div id="edit_div2" style="float:left;margin-left:10px;width:45%;overflow-wrap: break-word;"></div><div style="float:none;clear:both;"></div></div>');
+			$('#edit_div').css('height',$(window).height()*0.65);
+			$('#edit_div_title').html($($('#filetable tr').filter(".active").eq(0).find("td")[0]).find("input[type=hidden]")[0].value.trim()+"&nbsp;&nbsp;>&nbsp;&nbsp;"+$($('#filetable tr').filter(".active").eq(1).find("td")[0]).find("input[type=hidden]")[0].value.trim());
+			$.ajaxSettings.async = false;
+			$.post( "<?php echo php_self;?>", {
+				username: "<?php echo $username;?>",
+				password: "<?php echo md5($password);?>",
+				op: "readfile",
+				dir: "<?php echo $dir ?>",
+				file:$($('#filetable tr').filter(".active").eq(0).find("td")[0]).find("input[type=hidden]")[0].value.trim()
+			},
+			function ( data, status ) {
+				$('#edit_div1').html(data.string.replace(/\r\n/g,"<br/>"));
+			},"json");
+			$.post( "<?php echo php_self;?>", {
+				username: "<?php echo $username;?>",
+				password: "<?php echo md5($password);?>",
+				op: "readfile",
+				dir: "<?php echo $dir ?>",
+				file:$($('#filetable tr').filter(".active").eq(1).find("td")[0]).find("input[type=hidden]")[0].value.trim()
+			},
+			function ( data, status ) {
+				$('#edit_div2').html(data.string.replace(/\r\n/g,"<br/>"));
+			},"json");
+			var op = eq({ 
+				value1: document.getElementById("edit_div1").innerHTML, 
+				value2: document.getElementById("edit_div2").innerHTML 
+			});
+			document.getElementById("edit_div1").innerHTML=op.value1+"\r\n";
+			document.getElementById("edit_div2").innerHTML=op.value2+"\r\n";
+			$.ajaxSettings.async = true;
+			$( '#myModal' ).modal( {
+				backdrop: false
+			} )
+		}
 		function fpreview( fname, op ) {
 			<?php writelog("预览文件".$opendfile);?>
 			switch ( op ) {
@@ -1636,7 +1803,7 @@ function loadScript( $init = false ) {
 					$( "#loadModal" ).html('<?php loadModal(); ?>');
 					$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "previewedit",
 						dir: "<?php echo $dir ?>",
 						file:fname
@@ -1689,7 +1856,7 @@ function loadScript( $init = false ) {
 				case "download":
 					$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "download",
 						dir: "<?php echo $dir ?>",
 						file:fname
@@ -1713,7 +1880,7 @@ function loadScript( $init = false ) {
 					$( "#loadModal" ).html('<?php loadModal(); ?>');
 					$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "pzip",
 						dir: "<?php echo $dir ?>",
 						file:fname
@@ -1738,14 +1905,14 @@ function loadScript( $init = false ) {
 		function fdownload(dirname, filename){
 			$.post( "<?php echo php_self;?>", {
 				username: "<?php echo $username;?>",
-				password: "<?php echo $password;?>",
+				password: "<?php echo md5($password);?>",
 				op: "download",
 				dir: dirname,
 				file:filename
 			},
 			function ( data, status ) {
 				if ('msSaveOrOpenBlob' in navigator){
-				window.navigator.msSaveOrOpenBlob(new Blob([data]), '<?php echo php_self.'/' ?>'+dirname+'/'+filename);
+					window.navigator.msSaveOrOpenBlob(new Blob([data]), '<?php echo php_self.'/' ?>'+dirname+'/'+filename);
 				}else{
 				   	var url = window.URL.createObjectURL(new Blob([data], { type: "application/octet-stream" }));
 				   	var link = document.createElement('a');
@@ -1772,7 +1939,7 @@ function loadScript( $init = false ) {
 			$( "#loadModal" ).html('<?php loadModal(); ?>');
 			$.post( "<?php echo php_self;?>", {
 				username: "<?php echo $username;?>",
-				password: "<?php echo $password;?>",
+				password: "<?php echo md5($password);?>",
 				op: "pzip",
 				dir: dirname,
 				file:filename
@@ -1792,7 +1959,7 @@ function loadScript( $init = false ) {
 		function unarchive2(dirname, filename){
 			$.post( "<?php echo php_self;?>", {
 						username: "<?php echo $username;?>",
-						password: "<?php echo $password;?>",
+						password: "<?php echo md5($password);?>",
 						op: "unarchive",
 						dir: dirname,
 						file:filename
@@ -1831,7 +1998,7 @@ function loadScript( $init = false ) {
 			$( "#loadModal" ).html('<?php loadModal(); ?>');
 			$.post( "<?php echo php_self;?>", {
 				username: "<?php echo $username;?>",
-				password: "<?php echo $password;?>",
+				password: "<?php echo md5($password);?>",
 				op: "readfile",
 				dir: dirname,
 				file:filename
@@ -1852,7 +2019,7 @@ function loadScript( $init = false ) {
 				$( "#loadModal" ).html('<?php loadModal(); ?>');
 				$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "save",
 					dir: dirname,
 					file:filename,
@@ -1909,7 +2076,7 @@ function loadScript( $init = false ) {
 		function sort(dirname, ordername, sortname){
 			$.post( "<?php echo php_self;?>", {
 					username: "<?php echo $username;?>",
-					password: "<?php echo $password;?>",
+					password: "<?php echo md5($password);?>",
 					op: "showfilelist",
 					dir: dirname,
 					order: ordername,
@@ -1919,12 +2086,131 @@ function loadScript( $init = false ) {
 					$( "#main" ).html( data );
 				} );
 		}
+		function eq(op) {
+                if(!op){
+                    return op;
+                }
+                if(!op.value1_style){
+                    op.value1_style="background-color:#FEC8C8;";
+                }
+                if(!op.value2_style){
+                    op.value2_style="background-color:#FEC8C8;";
+                }
+                if(!op.eq_min){
+                    op.eq_min=3;
+                }
+                if(!op.eq_index){
+                    op.eq_index=5;
+                }
+                if (!op.value1 || !op.value2) {
+                    return op;
+                }
+                var ps = {
+                    v1_i: 0,
+                    v1_new_value: "",
+                    v2_i: 0,
+                    v2_new_value: ""
+                };
+                while (ps.v1_i < op.value1.length && ps.v2_i < op.value2.length) {
+                    if (op.value1[ps.v1_i] == op.value2[ps.v2_i]) {
+                        ps.v1_new_value += op.value1[ps.v1_i].replace(/</g,"<").replace(">",">");
+                        ps.v2_new_value += op.value2[ps.v2_i].replace(/</g,"<").replace(">",">");
+                        ps.v1_i += 1;
+                        ps.v2_i += 1;
+                        if (ps.v1_i >= op.value1.length) {
+                            ps.v2_new_value += "<span style='" + op.value2_style + "'>" + op.value2.substr(ps.v2_i).replace(/</g,"<").replace(">",">") + "</span>";
+                            break;
+                        }
+                        if (ps.v2_i >= op.value2.length) {
+                            ps.v1_new_value += "<span style='" + op.value1_style + "'>" + op.value1.substr(ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
+                            break;
+                        }
+                    } else {
+                        ps.v1_index = ps.v1_i + 1;
+                        ps.v1_eq_length = 0;
+                        ps.v1_eq_max = 0;
+                        ps.v1_start = ps.v1_i + 1;
+                        while (ps.v1_index < op.value1.length) {
+                            if (op.value1[ps.v1_index] == op.value2[ps.v2_i + ps.v1_eq_length]) {
+                                ps.v1_eq_length += 1;
+                            } else if (ps.v1_eq_length > 0) {
+                                if (ps.v1_eq_max < ps.v1_eq_length) {
+                                    ps.v1_eq_max = ps.v1_eq_length;
+                                    ps.v1_start = ps.v1_index - ps.v1_eq_length;
+                                }
+                                ps.v1_eq_length = 0;
+                                break;//只寻找最近的
+                            }
+                            ps.v1_index += 1;
+                        }
+                        if (ps.v1_eq_max < ps.v1_eq_length) {
+                            ps.v1_eq_max = ps.v1_eq_length;
+                            ps.v1_start = ps.v1_index - ps.v1_eq_length;
+                        }
+ 
+                        ps.v2_index = ps.v2_i + 1;
+                        ps.v2_eq_length = 0;
+                        ps.v2_eq_max = 0;
+                        ps.v2_start = ps.v2_i + 1;
+                        while (ps.v2_index < op.value2.length) {
+                            if (op.value2[ps.v2_index] == op.value1[ps.v1_i + ps.v2_eq_length]) {
+                                ps.v2_eq_length += 1;
+                            } else if (ps.v2_eq_length > 0) {
+                                if (ps.v2_eq_max < ps.v2_eq_length) {
+                                    ps.v2_eq_max = ps.v2_eq_length;
+                                    ps.v2_start = ps.v2_index - ps.v2_eq_length;
+                                }
+                                ps.v1_eq_length = 0;
+                                break;//只寻找最近的
+                            }
+                            ps.v2_index += 1;
+                        }
+                        if (ps.v2_eq_max < ps.v2_eq_length) {
+                            ps.v2_eq_max = ps.v2_eq_length;
+                            ps.v2_start = ps.v2_index - ps.v2_eq_length;
+                        }
+                        if (ps.v1_eq_max < op.eq_min && ps.v1_start - ps.v1_i > op.eq_index) {
+                            ps.v1_eq_max = 0;
+                        }
+                        if (ps.v2_eq_max < op.eq_min && ps.v2_start - ps.v2_i > op.eq_index) {
+                            ps.v2_eq_max = 0;
+                        }
+                        if ((ps.v1_eq_max == 0 && ps.v2_eq_max == 0)) {
+                            ps.v1_new_value += "<span style='" + op.value1_style + "'>" + op.value1[ps.v1_i].replace(/</g,"<").replace(">",">") + "</span>";
+                            ps.v2_new_value += "<span style='" + op.value2_style + "'>" + op.value2[ps.v2_i].replace(/</g,"<").replace(">",">") + "</span>";
+                            ps.v1_i += 1;
+                            ps.v2_i += 1;
+ 
+                            if (ps.v1_i >= op.value1.length) {
+                                ps.v2_new_value += "<span style='" + op.value2_style + "'>" + op.value2.substr(ps.v2_i).replace(/</g,"<").replace(">",">") + "</span>";
+                                break;
+                            }
+                            if (ps.v2_i >= op.value2.length) {
+                                ps.v1_new_value += "<span style='" + op.value1_style + "'>" + op.value1.substr(ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
+                                break;
+                            }
+                        } else if (ps.v1_eq_max > ps.v2_eq_max) {
+                            ps.v1_new_value += "<span style='" + op.value1_style + "'>" + op.value1.substr(ps.v1_i, ps.v1_start - ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
+                            ps.v1_i = ps.v1_start;
+                        } else {
+                            ps.v2_new_value += "<span style='" + op.value2_style + "'>" + op.value2.substr(ps.v2_i, ps.v2_start - ps.v2_i).replace(/</g,"<").replace(">",">") + "</span>";
+                            ps.v2_i = ps.v2_start;
+                        }
+                    }
+                }
+                op.value1 = ps.v1_new_value;
+                op.value2 = ps.v2_new_value;
+                return op;
+            }
 	</script>
 	<?php
 }
 ?>
 <?php
-if ( !isset( $_POST[ 'username' ] ) || !isset( $_POST[ 'password' ] ) || ( htmlspecialchars( $_POST[ 'username' ] ) != $username ) || ( htmlspecialchars( $_POST[ 'password' ] ) != $password ) ) {
+if ( !isset( $_POST[ 'username' ] ) ||
+	 !isset( $_POST[ 'password' ] ) || 
+	 ( htmlspecialchars( $_POST[ 'username' ] ) != $username ) || 
+	 ( htmlspecialchars( $_POST[ 'password' ] ) != md5($password) ) ) {
 	//检测出未登录。或者是直接传送操作数据，没有用户名密码，屏蔽恶意攻击或篡改系统
 	maintop();
 	?>
@@ -1936,12 +2222,208 @@ if ( !isset( $_POST[ 'username' ] ) || !isset( $_POST[ 'password' ] ) || ( htmls
 		<input type="password" id="password" class="form-control" name="password" <?php if(isset($_COOKIE[ 'password'])){echo ' value="'.$_COOKIE[ 'password']. '"';}?> placeholder="请输入密码" required>
 		<div class="checkbox">
 			<label>
-	            <input type="checkbox" name="remember-me"<?php if(isset($_COOKIE['username'])||isset($_COOKIE['password'])){echo ' checked="checked"';}?>> 记住我
+	            <input type="checkbox" id="remember-me" name="remember-me"<?php if(isset($_COOKIE['username'])||isset($_COOKIE['password'])){echo ' checked="checked"';}?>> 记住我
 	          </label>
 		
 		</div>
 		<button class="btn btn-lg btn-primary btn-block" type="submit">登录</button>
 	</form>
+	<script>
+	var str="";
+		$('#password').focus(function(){
+			str=$(this).val();
+		});
+		$('#password').blur(function(){
+			if(str!=$(this).val()){
+				$(this).val(MD5($(this).val()));
+			}
+		});
+		$('#password').keypress(function(event){
+			var keycode = (event.keyCode ? event.keyCode : event.which);
+			if(keycode == '13'){
+				$(this).val(MD5($(this).val()));
+			}
+		});
+		
+var MD5 = function (string) {
+ function RotateLeft(lValue, iShiftBits) {
+  return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));
+ }
+ function AddUnsigned(lX,lY) {
+  var lX4,lY4,lX8,lY8,lResult;
+  lX8 = (lX & 0x80000000);
+  lY8 = (lY & 0x80000000);
+  lX4 = (lX & 0x40000000);
+  lY4 = (lY & 0x40000000);
+  lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);
+  if (lX4 & lY4) {
+   return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
+  }
+  if (lX4 | lY4) {
+   if (lResult & 0x40000000) {
+    return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
+   } else {
+    return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
+   }
+  } else {
+   return (lResult ^ lX8 ^ lY8);
+  }
+  }
+  function F(x,y,z) { return (x & y) | ((~x) & z); }
+  function G(x,y,z) { return (x & z) | (y & (~z)); }
+  function H(x,y,z) { return (x ^ y ^ z); }
+ function I(x,y,z) { return (y ^ (x | (~z))); }
+ function FF(a,b,c,d,x,s,ac) {
+  a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
+  return AddUnsigned(RotateLeft(a, s), b);
+ };
+ function GG(a,b,c,d,x,s,ac) {
+  a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
+  return AddUnsigned(RotateLeft(a, s), b);
+ };
+ function HH(a,b,c,d,x,s,ac) {
+  a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
+  return AddUnsigned(RotateLeft(a, s), b);
+ };
+ function II(a,b,c,d,x,s,ac) {
+  a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
+  return AddUnsigned(RotateLeft(a, s), b);
+ };
+ function ConvertToWordArray(string) {
+  var lWordCount;
+  var lMessageLength = string.length;
+  var lNumberOfWords_temp1=lMessageLength + 8;
+  var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;
+  var lNumberOfWords = (lNumberOfWords_temp2+1)*16;
+  var lWordArray=Array(lNumberOfWords-1);
+  var lBytePosition = 0;
+  var lByteCount = 0;
+  while ( lByteCount < lMessageLength ) {
+   lWordCount = (lByteCount-(lByteCount % 4))/4;
+   lBytePosition = (lByteCount % 4)*8;
+   lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount)<<lBytePosition));
+   lByteCount++;
+  }
+  lWordCount = (lByteCount-(lByteCount % 4))/4;
+  lBytePosition = (lByteCount % 4)*8;
+  lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);
+  lWordArray[lNumberOfWords-2] = lMessageLength<<3;
+  lWordArray[lNumberOfWords-1] = lMessageLength>>>29;
+  return lWordArray;
+ };
+ function WordToHex(lValue) {
+  var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;
+  for (lCount = 0;lCount<=3;lCount++) {
+   lByte = (lValue>>>(lCount*8)) & 255;
+   WordToHexValue_temp = "0" + lByte.toString(16);
+   WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);
+  }
+  return WordToHexValue;
+ };
+ function Utf8Encode(string) {
+  string = string.replace(/\r\n/g,"\n");
+  var utftext = "";
+  for (var n = 0; n < string.length; n++) {
+   var c = string.charCodeAt(n);
+   if (c < 128) {
+    utftext += String.fromCharCode(c);
+   }
+   else if((c > 127) && (c < 2048)) {
+    utftext += String.fromCharCode((c >> 6) | 192);
+    utftext += String.fromCharCode((c & 63) | 128);
+   }
+   else {
+    utftext += String.fromCharCode((c >> 12) | 224);
+    utftext += String.fromCharCode(((c >> 6) & 63) | 128);
+    utftext += String.fromCharCode((c & 63) | 128);
+   }
+  }
+  return utftext;
+ };
+ var x=Array();
+ var k,AA,BB,CC,DD,a,b,c,d;
+ var S11=7, S12=12, S13=17, S14=22;
+ var S21=5, S22=9 , S23=14, S24=20;
+ var S31=4, S32=11, S33=16, S34=23;
+ var S41=6, S42=10, S43=15, S44=21;
+ string = Utf8Encode(string);
+ x = ConvertToWordArray(string);
+ a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;
+ for (k=0;k<x.length;k+=16) {
+  AA=a; BB=b; CC=c; DD=d;
+  a=FF(a,b,c,d,x[k+0], S11,0xD76AA478);
+  d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);
+  c=FF(c,d,a,b,x[k+2], S13,0x242070DB);
+  b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);
+  a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);
+  d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);
+  c=FF(c,d,a,b,x[k+6], S13,0xA8304613);
+  b=FF(b,c,d,a,x[k+7], S14,0xFD469501);
+  a=FF(a,b,c,d,x[k+8], S11,0x698098D8);
+  d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);
+  c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);
+  b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);
+  a=FF(a,b,c,d,x[k+12],S11,0x6B901122);
+  d=FF(d,a,b,c,x[k+13],S12,0xFD987193);
+  c=FF(c,d,a,b,x[k+14],S13,0xA679438E);
+  b=FF(b,c,d,a,x[k+15],S14,0x49B40821);
+  a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);
+  d=GG(d,a,b,c,x[k+6], S22,0xC040B340);
+  c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);
+  b=GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);
+  a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);
+  d=GG(d,a,b,c,x[k+10],S22,0x2441453);
+  c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);
+  b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);
+  a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);
+  d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);
+  c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);
+  b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);
+  a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);
+  d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);
+  c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);
+  b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);
+  a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);
+  d=HH(d,a,b,c,x[k+8], S32,0x8771F681);
+  c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);
+  b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);
+  a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);
+  d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);
+  c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);
+  b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);
+  a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);
+  d=HH(d,a,b,c,x[k+0], S32,0xEAA127FA);
+  c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);
+  b=HH(b,c,d,a,x[k+6], S34,0x4881D05);
+  a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);
+  d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);
+  c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);
+  b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);
+  a=II(a,b,c,d,x[k+0], S41,0xF4292244);
+  d=II(d,a,b,c,x[k+7], S42,0x432AFF97);
+  c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);
+  b=II(b,c,d,a,x[k+5], S44,0xFC93A039);
+  a=II(a,b,c,d,x[k+12],S41,0x655B59C3);
+  d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);
+  c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);
+  b=II(b,c,d,a,x[k+1], S44,0x85845DD1);
+  a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);
+  d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);
+  c=II(c,d,a,b,x[k+6], S43,0xA3014314);
+  b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);
+  a=II(a,b,c,d,x[k+4], S41,0xF7537E82);
+  d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);
+  c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);
+  b=II(b,c,d,a,x[k+9], S44,0xEB86D391);
+  a=AddUnsigned(a,AA);
+  b=AddUnsigned(b,BB);
+  c=AddUnsigned(c,CC);
+  d=AddUnsigned(d,DD);
+ }
+ var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);
+ return temp.toLowerCase();
+}
+	</script>
 	<?php
 	mainbottom();
 	exit;
@@ -2090,6 +2572,13 @@ if ( !isset( $_POST[ 'username' ] ) || !isset( $_POST[ 'password' ] ) || ( htmls
 		exit;
 	}
 	//如果不是ajax请求，则正常显示界面
+	if(isset($_POST['remember-me'])){
+		setcookie('username',$_POST[ 'username' ]);
+		setcookie('password',md5($_POST[ 'password' ]));
+	}else{
+		setcookie('username','',time()-3600);
+		setcookie('password','',time()-3600);
+	}
 	$showNavbar = true;
 	maintop();
 	?>
